<script type="text/javascript">
  var all_cb_spans = $$(".learnopedia_bundle_element_inactive");
    for (var i = 0; i < all_cb_spans.length; i++){
      all_cb_spans[i].ordinal_cb_id = i;
    }

  Event.observe(window, 'load', function(){
    for (var i = 0; i < all_cb_spans.length; i++){
      all_cb_spans[i].observe('click', clicked_on_cb_span(all_cb_spans[i]));
    }
  });

  var clicked_once = false;
  var beginning_span = null;
  var user_cb_spans = [];

  function clicked_on_cb_span(cb_span){
    return function(){
      //do some resets
      $('cb_add').disabled = true;
      user_cb_spans = [];

      //completed the bundle assignment
      if (clicked_once){
        clicked_once = false;
        if (cb_span == beginning_span){
          cb_span.removeClassName('learnopedia_bundle_element_selected');
        }
        else {
          //find all spans in between this cb_span and beginning_span and "select" those
          var beginning_id = Math.min(beginning_span.ordinal_cb_id, cb_span.ordinal_cb_id);
          var ending_id = Math.max(beginning_span.ordinal_cb_id, cb_span.ordinal_cb_id);
          
          user_cb_spans = all_cb_spans.slice(beginning_id, ending_id + 1);
          user_cb_spans.each(function(cb_span){cb_span.addClassName('learnopedia_bundle_element_selected');});

          $('cb_add').disabled = false;
        }
      }


      //beginning the bundle assignment
      else {
        clicked_once = true;
        //highlight this span
        beginning_span = cb_span;
        cb_span.addClassName('learnopedia_bundle_element_selected');
      }
    }
  }

  function add_cb_learnopedia(){
    //package up all cb_id's to send back to the server
    var cb_ids = user_cb_spans.map(function(cb_span){return cb_span.readAttribute('cb_id')});
    $('concept_bundle_cb_ids').value = cb_ids.toJSONString();
    return true;
  }
  
</script>